---
title: "Db Normalization 資料庫正規化"
date: 2023-05-04T23:18:44+08:00
draft: false
description: ""
---

### 為什麼要做『資料庫正規化』？

1. 降低資料的重複性
2. 避免資料更新異常

目的：希望可以提高資料庫的操作效率以及降低維護的困難度。

### 正規化的資料庫特性

經過正規化後的資料庫，應具備以下特性：

欄位唯一性：每個欄位只儲存一項資料
主關鍵欄位：每筆資料都擁有一個主鍵，來區別這些資料
功能關聯性：欄位之間的關聯應該要明確
欄位獨立性：欄位之間不應存在遞移相依

### 實際操作

直接從範例開始吧！以下是一份假想的購物紀錄。  
(*: primary key / ^: foreign key)

> ShoppingRecords

| 日期        | 商店  | 購買項目 | 單價 | 數量 | 總計 |
| ---------- | ---- | ------ | --- | ---- | ---- |
| 2022/12/26 | 全聯  | 雞蛋, 衛生紙, 高麗菜 | 100, 120, 79 | 1, 1, 2| 378 |
| 2022/12/29 | 全聯  | 美生菜, 豆腐 | 60, 40 | 1, 2| 140 |
| 2023/01/14 | 711 | 茶葉蛋 | 10 | 2| 20 |
| 2023/02/04 | 全聯  | 雞蛋 | 100 | 2 | 100 |

### 第一正規化

欄位只能有單一值（去除非基元值）、決定主鍵、消除重複的資料

> ShoppingRecords

| ID | 日期        | 商店  | 購買項目 | 單價 | 數量 | 總計 |
| -- | ---------- | ---- | ------ | --- | ---- | ---- |
| 1  | 2022/12/26 | 全聯  | 雞蛋 | 100 | 1 | 100 |
| 2  | 2022/12/26 | 全聯  | 衛生紙 | 120 | 1 | 120 |
| 3  | 2022/12/26 | 全聯  | 高麗菜 | 79 | 2| 158 |
| 4  | 2022/12/29 | 全聯  | 美生菜 | 60 | 1 | 60 |
| 5  | 2022/12/29 | 全聯  | 豆腐 | 40 | 2 | 80 |
| 6  | 2023/01/14 | 711 | 茶葉蛋 | 10 | 2 | 20 |
| 7  | 2023/02/04 | 全聯  | 雞蛋 | 100 | 2 | 100 |

### 第二正規化

符合第一正規化 ＆ 消除部分相依（除了主鍵以外，每一欄(column)資料都必須要依賴主鍵）、刪除重複資料

> ShoppingRecords

| ID | 日期       | 商品ID^ | 數量 | 總計 |
| -- | ---------- | ----- |---- | ---- |
| 1  | 2022/12/26 | 1     | 1   | 100 |
| 2  | 2022/12/26 | 2     | 1   | 120 |
| 3  | 2022/12/26 | 3     | 2   | 158 |
| 4  | 2022/12/29 | 4     | 1   | 60  |
| 5  | 2022/12/29 | 5     | 2   | 80  |
| 6  | 2023/01/14 | 6     | 2   | 20  |
| 7  | 2023/02/04 | 1     | 2   | 200 |

> Products

| 商品ID* | 商店   | 商品名稱  | 單價 |
| ------ | ------ | ------- | --- |
| 1      | 全聯    | 雞蛋     | 100 |
| 2      | 全聯    | 衛生紙   | 120 |
| 3      | 全聯    | 高麗菜   | 79  |
| 4      | 全聯    | 美生菜   | 60  |
| 5      | 全聯    | 豆腐     | 40  |
| 6      | 711    | 茶葉蛋   | 10  |

### 第三正規化

符合第二正規化 ＆ 消除遞移相依（非主鍵欄位有依賴主鍵以外的欄位）  
`ShoppingRecords`內的總計也是遞移相依的一種，因為如果改了商品的單價就會需要更新總計 => 拿掉總計欄位，需要的時候直接計算即可

> ShoppingRecords

| ID | 日期      | 商品ID^ | 數量 | 總計 |
| -- | --------- | ------ |---- | ---- |
| 1 | 2022/12/26 | 1      | 1   | 100 |
| 2 | 2022/12/26 | 2      | 1   | 120 |
| 3 | 2022/12/26 | 3      | 2   | 158 |
| 4 | 2022/12/29 | 4      | 1   | 60  |
| 5 | 2022/12/29 | 5      | 2   | 80  |
| 6 | 2023/01/14 | 6      | 2   | 20  |
| 7 | 2023/02/04 | 1      | 2   | 200 |

> Stores

| 商店ID* | 商店  |
| ------ | ---- |
| 1      | 全聯  | 
| 2      | 711  | 

> Products

| 商品ID* | 商店ID^ | 商品名稱  | 單價 |
| ------ | ------- | ------- | --- |
| 1      | 1       | 雞蛋     | 100 |
| 2      | 1       | 衛生紙   | 120 |
| 3      | 1       | 高麗菜   | 79  |
| 4      | 1       | 美生菜   | 60  |
| 5      | 1       | 豆腐     | 40  |
| 6      | 2       | 茶葉蛋   | 10  |